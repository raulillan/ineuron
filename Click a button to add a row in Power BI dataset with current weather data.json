{"$schema":"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#","contentVersion":"1.0.0.0","parameters":{"logicAppName":{"type":"String","metadata":{"description":"Name of the logic app."}},"logicAppLocation":{"defaultValue":"[resourceGroup().location]","allowedValues":["eastasia","southeastasia","centralus","eastus","eastus2","westus","northcentralus","southcentralus","northeurope","westeurope","japanwest","japaneast","brazilsouth","australiaeast","australiasoutheast","southindia","centralindia","westindia","canadacentral","canadaeast","uaecentral","westcentralus","westus2","[resourceGroup().location]"],"type":"String","metadata":{"description":"Location of the logic app."}}},"resources":[{"type":"Microsoft.Logic/workflows","apiVersion":"2016-06-01","name":"[parameters('logicAppName')]","location":"[parameters('logicAppLocation')]","properties":{"state":"Disabled","definition":{"$schema":"https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#","contentVersion":"1.0.0.0","parameters":{"$connections":{"defaultValue":{},"type":"Object"},"$authentication":{"defaultValue":{},"type":"SecureObject"}},"triggers":{"manual":{"metadata":{"operationMetadataId":"10f0bd18-c0c0-44ef-8ad4-dd29530c8100"},"type":"Request","kind":"Button","inputs":{"schema":{"type":"object","properties":{"key-button-date":{"type":"string","x-ms-dynamically-added":false}},"required":["key-button-date"]}}}},"actions":{"Get_forecast_for_today":{"runAfter":{},"metadata":{"operationMetadataId":"4143204b-fc42-4aee-a76d-ef04bd318048","flowSystemMetadata":{"swaggerOperationId":"TodaysForecast"}},"type":"ApiConnection","inputs":{"host":{"connection":{"name":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$connections']['msnweather']['connectionId']"}},"method":"get","path":"/forecast/today/@{encodeURIComponent('Las Rozas de Madrid, Spain')}","queries":{"units":"Metric"},"authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}},"Add_rows_to_a_dataset":{"runAfter":{"Get_forecast_for_today":["Succeeded"]},"metadata":{"operationMetadataId":"d03c550c-0061-4638-8f90-b8c3a095c573","flowSystemMetadata":{"swaggerOperationId":"AddRows"}},"type":"ApiConnection","inputs":{"host":{"connection":{"name":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$connections']['powerbi']['connectionId']"}},"method":"post","body":{"Date":"@{utcNow()}","Location":"@body('Get_forecast_for_today')?['responses']?['source']?['location']","Temperature":"@{body('Get_forecast_for_today')?['responses']?['daily']?['tempHi']}","Conditions":"@body('Get_forecast_for_today')?['responses']?['daily']?['pvdrCap']"},"path":"/v1.0/myorg/groups/@{encodeURIComponent('9911b75c-f0b6-48e7-8d4f-df4ccf910e71')}/datasets/@{encodeURIComponent(body('Get_forecast_for_today')?['responses']?['source']?['location'])}/tables/@{encodeURIComponent(body('Get_forecast_for_today')?['responses']?['daily']?['day']?['cap'])}/rows","authentication":{"type":"Raw","value":"@json(decodeBase64(triggerOutputs().headers['X-MS-APIM-Tokens']))['$ConnectionKey']"}}}},"outputs":{},"description":"Add a row in Power BI dataset with today's weather forecast on button click. The Power BI dataset table must have the columns: Date, Temperature, location, and Conditions."},"parameters":{},"runtimeConfiguration":{"lifetime":{"unit":"Day","count":30},"collections":{"maximumItemCount":100000},"performanceProfile":{"throttles":{"mode":"Medium"}},"retryPolicy":{"type":"Exponential","interval":"PT5M","count":2,"minimumInterval":"PT5M","maximumInterval":"PT1H"},"usageConfiguration":{"name":"USER-6C5BECFD93C54C0A911E2663787FCB10"}},"integrationAccount":{"name":"9562b42b4ea7451483126d67083c18e9-westeurope","id":"subscriptions/427976e2-4271-4308-afb8-d28d53a6ad06/resourceGroups/9562b42b4ea7451483126d67083c18e9-ia/providers/Microsoft.Logic/integrationAccounts/9562b42b4ea7451483126d67083c18e9-westeurope","type":"Microsoft.Logic/integrationAccounts"}}}]}